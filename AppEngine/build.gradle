buildscript {
	dependencies {
		// https://github.com/GoogleCloudPlatform/gradle-appengine-plugin
		classpath "com.google.appengine:gradle-appengine-plugin:${VERSION_APPENGINE}"
	}
}

apply plugin: 'java'
apply plugin: 'war'
apply plugin: 'appengine'
apply plugin: 'idea'

sourceCompatibility = JavaVersion.VERSION_1_7
targetCompatibility = JavaVersion.VERSION_1_7

configurations {
	provided
}
idea {
	module {
		scopes.PROVIDED.plus += [ configurations.provided ]
	}
}

dependencies {
	appengineSdk "com.google.appengine:appengine-java-sdk:${VERSION_APPENGINE}"
	// com.google.appengine.api.datastore
	compile "com.google.appengine:appengine-api-1.0-sdk:${VERSION_APPENGINE}"
	// com.google.api.server.spi.SystemServiceServlet
	compile "com.google.appengine:appengine-endpoints:${VERSION_APPENGINE}"

	def appengineRoot = "p:\\tools\\sdk\\appengine-java-sdk-${VERSION_APPENGINE}";
	provided fileTree(dir: "${appengineRoot}/lib/shared", include: '**/*.jar')
	provided fileTree(dir: "${appengineRoot}/lib/tools", include: '**/*.jar')
	provided fileTree(dir: "${appengineRoot}/lib/override", include: '**/*.jar')
	// The above should be equivalent to something like:
	//provided 'javax.servlet:servlet-api:2.5'
	//provided 'javax.servlet.jsp:jsp-api:2.2'
	//provided 'taglibs:standard:1.1.2'
	//provided 'jstl:jstl:1.2'

	compile project(':Shared')

	// See java.util.logging.properties and log4j2.xml
	compile "org.slf4j:slf4j-api:${VERSION_SLF4J}"
	compile "org.slf4j:slf4j-jdk14:${VERSION_SLF4J}" // route apps SLF4J logging to JUL
	provided "org.slf4j:jul-to-slf4j:${VERSION_SLF4J}" // DEV only
	provided "org.apache.logging.log4j:log4j-api:${VERSION_LOG4J}" // DEV only
	provided "org.apache.logging.log4j:log4j-core:${VERSION_LOG4J}" // DEV only
	provided "org.apache.logging.log4j:log4j-slf4j-impl:${VERSION_LOG4J}" // DEV only

	compile "ant:ant:1.6.5" // for org.apache.tools.ant.filters.StringInputStream
//	compile "com.google.guava:guava:14.0.1"
//	compile "joda-time:joda-time:2.3"

	apply from: "${rootDir}/gradle/testCompile.gradle", to: project
//	testCompile "com.google.appengine:appengine-testing:${VERSION_APPENGINE}"
//	testCompile "com.google.appengine:appengine-api-stubs:${VERSION_APPENGINE}"
//	testCompile "com.google.appengine:appengine-api-labs:${VERSION_APPENGINE}"
}

sourceSets {
	main {
		java.srcDir 'src/main/diff'
		compileClasspath += configurations.provided
		runtimeClasspath += configurations.provided
	}
	test {
		java.srcDir 'src/test/diff'
		compileClasspath += configurations.provided
		runtimeClasspath += configurations.provided
	}
}

appengine { // com.google.appengine.AppEnginePluginExtension
	httpPort = 8888
	downloadSdk = true
	app {
		id = 'twisterrob-london'
	}
	appcfg {
		email = 'papp.robert.s@gmail.com'
		oauth2 = true
	}
}

appengineDownloadApp {
	outputDirectory = file('build/downloaded')
}
